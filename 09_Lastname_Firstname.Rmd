---
title: "Homework: Simulation"
author: "Firstname Lastname"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
```

```{r load-sas-libraries, echo = F, message = F, warning = F}

library(SASmarkdown)
sas_enginesetup(sashtml=sashtml)

sasexe <- "C:/Program Files/SASHome/SASFoundation/9.4/sas.exe"
sasopts <- "-nosplash -ls 75"

# Linux options (for grading, please leave this in!)
# sasexe <- "/usr/local/SASHome/SASFoundation/9.4/bin/sas_en"
# sasopts <- "-ls 75"
```

## Instructions

When you are finished with the assignment:

1. Save the file as 09_Lastname_Firstname.Rmd and compile it
2. Commit the Rmd file and corresponding html file to your homework git repo
3. Push the commit to github
4. Locate the Rmd file on github and click on the SHA link for the file
5. Paste the url of the resulting page into Canvas to submit your assignment.

Your assignment must compile on a different computer as long as the saspath is set correctly for that machine.
This means you will need to use a local file path when you read the data in via R (and SAS).

## Is it in the cards?

In this task, you will create a simulation of a card or dice game of your choice. You might consider games such as [set](https://en.wikipedia.org/wiki/Set_(card_game)), [farkle](https://www.dicegamedepot.com/farkle-rules/), [blackjack](https://bicyclecards.com/how-to-play/blackjack/#filter), [war](https://bicyclecards.com/how-to-play/war/#filter), or [go fish](https://bicyclecards.com/how-to-play/go-fish/#filter). You may choose any game that can be assessed probabilistically -- you may want to avoid games which require a large amount of strategy, skill, and bluffing, such as poker. 

You don't need to necessarily simulate the full game mechanism, but you do need to implement enough of the game mechanism that you can identify an interesting probability question in your game and answer the question using a simulation.

### Scenario Description

When I was a kid, my parents taught my siblings and I to play hearts by describing the rules: the goal was to get rid of all of your hearts by burying them in other tricks.  

Bicycle Cards describes the rules as follows: 

> OBJECT OF THE GAME
To be the player with the lowest score at the end of the game. When one player hits the agreed-upon score or higher, the game ends; and the player with the lowest score wins.

> CARD VALUES/SCORING
> At the end of each hand, players count the number of hearts they have taken as well as the queen of spades, if applicable. Hearts count as one point each and the queen counts 13 points.    
Each heart - 1 point    
The Q - 13 points    
The aggregate total of all scores for each hand must be a multiple of 26.    
The game is usually played to 100 points (some play to 50).    
When a player takes all 13 hearts and the queen of spades in one hand, instead of losing 26 points, that player scores zero and each of his opponents score an additional 26 points.

At any rate, my parents left off the last part of the scoring mechanism, figuring that it was too complicated strategically for my siblings and I (I was the oldest and was about 11 at the time, so my younger brother would have been 6 or so). 

We started playing, and I ended up crying as we got to the end of the round, because I had collected every possible heart. I was *so mad* that despite my best attempts at strategy, I had lost so terribly.

When they counted the cards up, I had accidentally "shot the moon", and my dad got to explain that I'd actually won that round instead of losing it horribly.

What I'd like to know is whether or not my parents actually made a reasonable call - what is the probability that a completely naive player who doesn't know the full set of rules of the game accidentally shoots the moon? (I'm assuming that at 11 my strategic skills were not developed enough to do more than simple optimization of strategy).

### Set up your objects

> First, you must set up a data frame describing all possible values of your playing items. For instance, if you are using a standard deck of 52 playing cards, you'll need a data frame which has columns for suit and value, and you may want to make value a factor variable (your call on that one). If your game requires that players hold cards in their hand, you may also want to have a column indicating location (deck, discard, player_x). 

```{r}
library(tidyverse)
# make the cards ordered correctl
card_values <- factor(1:13, labels = c(2:10, "Jack", "Queen", "King", "Ace"))
suit <- c("hearts", "diamonds", "spades", "clubs")

deck_of_cards <- tidyr::crossing(suit, value = card_values) %>%
  mutate(points = (suit == "hearts") + 
           13*(suit == "spades" & value == "Queen"))
# it's often easier to add two logical statements 
# together and weight one of them than to create a 
# compound if function or a table that you could 
# use to make another join.
```

So I've created a standard deck of cards, and assigned each card the point value it has when scoring a game of hearts. 


### Write one or more functions to simulate the basic game mechanisms

> For instance, if you are simulating set, you need to have a function that draws 12 cards from the deck. You may want an auxiliary function which determines if a set is present.

```{r}
deal_hands <- function(deck, players = 1:4) {
  # Must have between 3 and 5 players"
  stopifnot(length(players) >= 3, length(players) <=5)
  deck %>%
    # shuffle the rows
    slice_sample(n = nrow(deck)) %>%
    mutate(player = rep(players, length.out = n())) %>%
    arrange(player, suit, value)
}

```

### Identify a probability question you can answer with your simulation

For instance, if you are simulating set, you may want to know the probability that an array of 12 cards does not contain a set. (You can check your answers by reading the rules of the game, if you want). If you are simulating blackjack, you may want to know what the [expected return on a specific strategy is](https://towardsdatascience.com/python-blackjack-simulator-61b591ffb971) (hint: if you're beating the dealer, your simulation is probably wrong). 

### Design a simulation to answer the question you identified

Run your simulation with an increasing number of iterations and create some sort of plot showing your results. 

Describe any issues you encountered in your simulation, and how you addressed them (or where the whole thing went off the rails, if you couldn't address everything in time). 




